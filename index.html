<script>
const videosBox = document.getElementById("videos");
const loadingScreen = document.getElementById("loadingScreen");

async function loadVideos() {
    try {
        const res = await fetch("videos.json", { cache: "no-store" });
        const data = await res.json();

        videosBox.innerHTML = "";

        data.forEach(v => {
            const div = document.createElement("div");
            div.className = "video";
            div.innerHTML = `
                <div class="player" data-iframe="${encodeURIComponent(v.iframe)}">
                    <img src="${v.thumb}" class="thumbnail">
                    <div class="overlay"></div>
                    <div class="videoTitle">${v.title}</div>
                    <div class="playBtn">▶</div>
                </div>
            `;
            videosBox.appendChild(div);
        });

        attachPlayers();
        preloadIframes(data);
        loadingScreen.style.display = "none";

    } catch (e) {
        loadingScreen.textContent = "❌ Błąd ładowania filmów";
        console.error(e);
    }
}

function attachPlayers() {
    document.querySelectorAll(".player").forEach(player => {
        player.addEventListener("click", () => {
            const iframe = decodeURIComponent(player.dataset.iframe);
            player.innerHTML = iframe;
        });
    });
}

function preloadIframes(videos) {
    videos.forEach(v => {
        const src = v.iframe.match(/src="([^"]+)"/)?.[1];
        if (!src) return;
        const iframe = document.createElement("iframe");
        iframe.src = src;
        iframe.style.display = "none";
        document.body.appendChild(iframe);
    });
}

loadVideos();
</script>
